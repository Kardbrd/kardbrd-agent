# kardbrd.yml â€” KABot workflow rules for kardbrd-agent repository
#
# All list-based rules use require_label: Agent so KABot only acts on
# Agent-labeled cards. Server cards (without Agent label) are left to MBPBot.
# @mentions always work regardless of labels (built-in handler).
#
# Reaction rules use require_user to restrict who can trigger actions.
# Paul's user ID: E21K9jmv
---

# â”€â”€ Stop active agent session â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- name: Stop agent
  event: reaction_added
  emoji: "ðŸ›‘"
  action: __stop__

# â”€â”€ List-based workflow rules (Agent-labeled cards only) â”€â”€â”€â”€â”€â”€â”€â”€â”€

# Card lands in Ideas â†’ deep exploration
- name: Explore new ideas
  event: card_created, card_moved
  list: Ideas
  model: opus
  require_label: Agent
  action: /ke

# Card moves to Plans â†’ create detailed implementation plan
- name: Plan on move to Plans
  event: card_moved
  list: Plans
  model: opus
  require_label: Agent
  action: /kp

# Card moves to In progress â†’ implement the plan
- name: Implement on move to In progress
  event: card_moved
  list: In progress
  model: sonnet
  require_label: Agent
  action: /ki

# Card moves to Review â†’ full code review
- name: Review on move to Review
  event: card_moved
  list: Review
  model: opus
  require_label: Agent
  action: /kr

# â”€â”€ Reaction-based triggers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# Paul reacts âœ… on a review comment â†’ merge PR to main
- name: Ship card via review approval
  event: reaction_added
  emoji: "âœ…"
  require_label: Agent
  require_user: E21K9jmv
  model: sonnet
  action: |
    The operator approved the review by reacting with âœ….
    Ship this card to production (merge the PR into main):
    1. Run `git status` and `git log --oneline main..HEAD` to see what's on this branch
    2. If there are uncommitted changes, commit them
    3. Push the branch to origin: `git push -u origin HEAD`
    4. Create a PR if one doesn't exist: `gh pr create --title "<card title> (<card_id>)" --body "Automated PR from kardbrd workflow"`
    5. Merge the PR: `gh pr merge --squash --delete-branch`
    6. Post a comment on the card confirming the merge with the PR URL and merge commit
